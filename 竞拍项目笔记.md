# 竞拍项目笔记

## 关于truffle test

1. truffle test 可以用solidity语言编写，也可以使用js。都是用的抹茶框架
2. 原理：truffle使用solidity编写测试用例，会首先部署测试合约，利用测试合约的实例去部署待测试的合约。而不是直接部署待测试的合约

- 深度测试：

发现 truffle test 与 truffle migrate的行为存在很大区别

1. 当使用test时，会发生很多小型交易，创建很多小合约。从交易信息中，并不能直接获取到各个真正的大合约信息。但也并不意味者没有部署大合约。从代码中打印其实可以获取到合约真正地址，并发现这个合约已经存在测试产生的脏数据。

2. 当使用migrate时，会发生有限个大交易，并且从交易明确对应合约的创建过程，有几个合约类，就会创建几个合约，非常清晰。而且合约是非常干净的。并且会存到migrate的变更记录中。

##  Stack too deep, try using fewer variables

目前的解决方案就是拆分

## 测试以太网交易时，测试合约本身没有钱怎么办？

根据官网链接描述：

    https://www.trufflesuite.com/docs/truffle/testing/writing-tests-in-solidity#testing-ether-transactions

You can also test how your contracts react to receiving Ether, and script that interaction within Solidity. To do so, your Solidity test should have a public function that returns a uint, called initialBalance. This can be written directly as a function or a public variable, as shown below. 

也就是说，truffle会自动识别一个叫initialBalance的公共变量，在测试之前转账对应数量的以太给测试合约。于是可以这样做：

    uint public initialBalance = 1 ether;
可以测试了！
